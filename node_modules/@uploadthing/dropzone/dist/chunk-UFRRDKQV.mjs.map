{"version":3,"sources":["../src/core.ts"],"sourcesContent":["/**\n * This is a forked version of the react-dropzone package, that's been minified\n * to suit UploadThing's needs and be easily portable to other frameworks than React.\n * See original source here: https://github.com/react-dropzone/react-dropzone\n * The original package is licensed under the MIT license.\n */\n\nimport attrAccepts from \"attr-accept\";\n\nimport type { AcceptProp, DropzoneState } from \"./types\";\n\n// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\nconst accepts: typeof attrAccepts =\n  // @ts-expect-error - ESM interop\n  typeof attrAccepts === \"function\" ? attrAccepts : attrAccepts.default;\n\n// Firefox versions prior to 53 return a bogus MIME type for every file drag, so dragovers with\n// that MIME type will always be accepted\nexport function isFileAccepted(file: File, accept: string | string[]) {\n  return file.type === \"application/x-moz-file\" || accepts(file, accept);\n}\n\nexport function isEnterOrSpace(event: { key?: string; keyCode?: number }) {\n  return (\n    (\"key\" in event && (event.key === \" \" || event.key === \"Enter\")) ||\n    (\"keyCode\" in event && (event.keyCode === 32 || event.keyCode === 13))\n  );\n}\n\nconst isDefined = <T>(v: T | null | undefined): v is T => v != null;\nexport function isValidSize(file: File, minSize: number, maxSize: number) {\n  if (!isDefined(file.size)) return true;\n  if (isDefined(minSize) && isDefined(maxSize)) {\n    return file.size >= minSize && file.size <= maxSize;\n  }\n  if (isDefined(minSize) && file.size < minSize) return false;\n  if (isDefined(maxSize) && file.size > maxSize) return false;\n  return true;\n}\n\nexport function isValidQuantity(\n  files: File[],\n  multiple: boolean,\n  maxFiles: number,\n) {\n  if (!multiple && files.length > 1) return false;\n  if (multiple && maxFiles >= 1 && files.length > maxFiles) return false;\n  return true;\n}\n\nexport function allFilesAccepted({\n  files,\n  accept,\n  minSize,\n  maxSize,\n  multiple,\n  maxFiles,\n}: {\n  files: File[];\n  accept: string | string[];\n  minSize: number;\n  maxSize: number;\n  multiple: boolean;\n  maxFiles: number;\n}) {\n  if (!isValidQuantity(files, multiple, maxFiles)) return false;\n\n  return files.every(\n    (file) =>\n      isFileAccepted(file, accept) && isValidSize(file, minSize, maxSize),\n  );\n}\n\nexport function isEventWithFiles(event: Partial<Event>) {\n  if (!(\"dataTransfer\" in event && event.dataTransfer !== null)) {\n    return !!event.target && \"files\" in event.target && !!event.target.files;\n  }\n  // https://developer.mozilla.org/en-US/docs/Web/API/DataTransfer/types\n  // https://developer.mozilla.org/en-US/docs/Web/API/HTML_Drag_and_Drop_API/Recommended_drag_types#file\n  return Array.prototype.some.call(\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n    (event.dataTransfer as any)?.types,\n    (type) => type === \"Files\" || type === \"application/x-moz-file\",\n  );\n}\n\nexport function isIeOrEdge(ua = window.navigator.userAgent) {\n  return (\n    ua.indexOf(\"MSIE \") > -1 ||\n    ua.indexOf(\"Trident/\") > -1 ||\n    ua.indexOf(\"Edge/\") > -1\n  );\n}\n\nfunction isMIMEType(v: string) {\n  return (\n    v === \"audio/*\" ||\n    v === \"video/*\" ||\n    v === \"image/*\" ||\n    v === \"text/*\" ||\n    /\\w+\\/[-+.\\w]+/g.test(v)\n  );\n}\n\nfunction isExt(v: string) {\n  return /^.*\\.[\\w]+$/.test(v);\n}\n\n/**\n * Convert the `{accept}` dropzone prop to an array of MIME types/extensions.\n */\nexport function acceptPropAsAcceptAttr(accept?: AcceptProp) {\n  if (isDefined(accept)) {\n    return (\n      Object.entries(accept)\n        .reduce<string[]>((a, [mimeType, ext]) => [...a, mimeType, ...ext], [])\n        // Silently discard invalid entries as pickerOptionsFromAccept warns about these\n        .filter((v) => isMIMEType(v) || isExt(v))\n        .join(\",\")\n    );\n  }\n\n  return undefined;\n}\n\nexport function noop() {\n  // noop\n}\n\n/**\n * ================================================\n *                    Reducer\n * ================================================\n */\ntype Payload<T extends keyof DropzoneState> = Pick<DropzoneState, T>;\n\ntype Focus = { type: \"focus\" };\ntype Blur = { type: \"blur\" };\ntype OpenDialog = { type: \"openDialog\" };\ntype CloseDialog = { type: \"closeDialog\" };\ntype SetDraggedFiles = {\n  type: \"setDraggedFiles\";\n  payload: Payload<\"isDragActive\" | \"isDragAccept\" | \"isDragReject\">;\n};\ntype SetFiles = { type: \"setFiles\"; payload: Payload<\"acceptedFiles\"> };\ntype Reset = { type: \"reset\" };\ntype DropzoneActions =\n  | Focus\n  | Blur\n  | OpenDialog\n  | CloseDialog\n  | SetDraggedFiles\n  | SetFiles\n  | Reset;\n\nexport const initialState = {\n  isFocused: false,\n  isFileDialogActive: false,\n  isDragActive: false,\n  isDragAccept: false,\n  isDragReject: false,\n  acceptedFiles: [] as File[],\n};\n\nexport function reducer(\n  state: DropzoneState,\n  action: DropzoneActions,\n): DropzoneState {\n  switch (action.type) {\n    case \"focus\":\n      return {\n        ...state,\n        isFocused: true,\n      };\n    case \"blur\":\n      return {\n        ...state,\n        isFocused: false,\n      };\n    case \"openDialog\":\n      return {\n        ...initialState,\n        isFileDialogActive: true,\n      };\n    case \"closeDialog\":\n      return {\n        ...state,\n        isFileDialogActive: false,\n      };\n    case \"setDraggedFiles\":\n      return {\n        ...state,\n        ...action.payload,\n      };\n    case \"setFiles\":\n      return {\n        ...state,\n        ...action.payload,\n      };\n    case \"reset\":\n      return initialState;\n    default:\n      return state;\n  }\n}\n"],"mappings":"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","names":[]}